<!doctype html>
<title>Railroad Diagram Generator</title>
<link href="railroad-diagrams.css" rel=stylesheet>

<textarea class='input'>Diagram(
  Optional('+', 'skip'),
  Choice(0,
    NonTerminal('name-start char'),
    NonTerminal('escape')),
  ZeroOrMore(
    Choice(0,
      NonTerminal('name char'),
      NonTerminal('escape'))))</textarea>
<div class='output-image'></div>
<textarea class='output-text' readonly></textarea>

<script type=module>
import rr, * as rrClass from "./railroad.js";
Object.assign(window, rr);
console.log(rr);

const find = document.querySelector.bind(document);

find('.input').addEventListener('input', process, false);
document.addEventListener('DOMContentLoaded', initialProcess, false);
window.addEventListener('hashchange', initialProcess, false);

function initialProcess() {
	if( location.hash && location.hash.length > 1) {
		find('.input').textContent = decodeURIComponent(location.hash.substr(1))
	}
	process();
}

function process() {
	var input = find('.input').value;
	try {
		var result = eval(input).format();
	} catch (e) {
		find('.output-text').textContent = "Invalid input.\n" + e
		return;
	}
	find('.output-image').innerHTML = '';
	result.addTo(find('.output-image'));
	find('.output-text').textContent = result;
}
</script>

<style>
html, body { margin: 0; padding: 0; height: 100%; }
body {
	display: grid;
	grid-template:
		"input  code" 1fr
		"output output" 1fr
		/ 1fr   1fr;
}
.input {
	grid-area: input;
}
.output-text {
	grid-area: code;
}
.output-image {
	grid-area: output;
}
</style>
